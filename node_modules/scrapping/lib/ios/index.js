var Ios = function(url){

	this._url 		= url;
	this._urlApi		=require('url');
	this._http 		= require('http');
	this._jsonSchema 	= require('./config/jsonSchema.json');
	this._dataStore 	={};
	this._apiStoreUrl	= "itunes.apple.com";
}

Ios.prototype.getInformationStore = function(cb){
	var 	self 	=this,
		lang 	= this._urlApi.parse(this._url, true).path.split('/', 2)[1],
		id 	= this._urlApi.parse(this._url, false).pathname.split('/id', 2)[1],
		url 	= this._apiStoreUrl.replace('{lang}', lang).replace('{id}', id);

	var options = {
		host: this._apiStoreUrl,
		path: '/'+lang+'/lookup?id='+id,
		method: 'GET'
	};

	var req = this._http.get(options, function(res) {
		var json='';
		res.on('data', function (chunk) {
			json+=chunk;
		});
		res.on('end', function (chunk) {
			json = JSON.parse(json);
			json = json.results;
			json = json[0];
			for(entry in self._jsonSchema){
				self._dataStore[entry] =  json[self._jsonSchema[entry]];
			}
			if(typeof cb == 'function'){
				cb(self._dataStore);
			}	
		});  
	 });
}

module.exports = Ios;